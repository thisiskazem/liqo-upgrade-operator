apiVersion: v1
kind: ConfigMap
metadata:
  name: liqo-target-descriptors
  namespace: liqo
  labels:
    app.kubernetes.io/name: liqo-upgrade
    app.kubernetes.io/component: target-descriptor
data:
  v1.0.0.json: |
    {
      "version": "v1.0.0",
      "components": [
        {
          "name": "liqo-controller-manager",
          "kind": "Deployment",
          "namespace": "liqo",
          "containerName": "controller-manager",
          "image": {
            "repository": "ghcr.io/liqotech/liqo-controller-manager",
            "tag": "v1.0.0"
          },
          "args": [
            "--cluster-id=$(CLUSTER_ID)",
            "--liqo-namespace=$(POD_NAMESPACE)",
            "--networking-enabled=true",
            "--authentication-enabled=true",
            "--offloading-enabled=true"
          ],
          "env": [
            {
              "name": "CLUSTER_ID",
              "type": "configMapKeyRef",
              "configMapName": "liqo-cluster-id",
              "key": "CLUSTER_ID"
            },
            {
              "name": "POD_NAMESPACE",
              "type": "fieldRef",
              "value": "metadata.namespace"
            }
          ]
        },
        {
          "name": "liqo-crd-replicator",
          "kind": "Deployment",
          "namespace": "liqo",
          "containerName": "crd-replicator",
          "image": {
            "repository": "ghcr.io/liqotech/crd-replicator",
            "tag": "v1.0.0"
          },
          "args": [],
          "env": []
        },
        {
          "name": "liqo-webhook",
          "kind": "Deployment",
          "namespace": "liqo",
          "containerName": "webhook",
          "image": {
            "repository": "ghcr.io/liqotech/webhook",
            "tag": "v1.0.0"
          },
          "args": [
            "--webhook-port=9443"
          ],
          "env": []
        },
        {
          "name": "liqo-ipam",
          "kind": "Deployment",
          "namespace": "liqo",
          "containerName": "ipam",
          "image": {
            "repository": "ghcr.io/liqotech/ipam",
            "tag": "v1.0.0"
          },
          "args": [
            "--pod-name=$(POD_NAME)",
            "--port=6000"
          ],
          "env": [
            {
              "name": "POD_NAME",
              "type": "fieldRef",
              "value": "metadata.name"
            },
            {
              "name": "POD_NAMESPACE",
              "type": "fieldRef",
              "value": "metadata.namespace"
            }
          ]
        },
        {
          "name": "liqo-proxy",
          "kind": "Deployment",
          "namespace": "liqo",
          "containerName": "liqo-proxy",
          "image": {
            "repository": "ghcr.io/liqotech/proxy",
            "tag": "v1.0.0"
          },
          "args": [],
          "env": []
        },
        {
          "name": "liqo-fabric",
          "kind": "DaemonSet",
          "namespace": "liqo",
          "containerName": "liqo-fabric",
          "image": {
            "repository": "ghcr.io/liqotech/fabric",
            "tag": "v1.0.0"
          },
          "args": [
            "--podname=$(POD_NAME)",
            "--nodename=$(NODE_NAME)",
            "--geneve-port=6081"
          ],
          "env": [
            {
              "name": "NODE_NAME",
              "type": "fieldRef",
              "value": "spec.nodeName"
            },
            {
              "name": "POD_NAME",
              "type": "fieldRef",
              "value": "metadata.name"
            }
          ]
        },
        {
          "name": "liqo-gateway",
          "kind": "Deployment",
          "namespace": "liqo",
          "containerName": "gateway",
          "image": {
            "repository": "ghcr.io/liqotech/gateway",
            "tag": "v1.0.0"
          },
          "args": [],
          "env": []
        },
        {
          "name": "liqo-metric-agent",
          "kind": "Deployment",
          "namespace": "liqo",
          "containerName": "metric-agent",
          "image": {
            "repository": "ghcr.io/liqotech/metric-agent",
            "tag": "v1.0.0"
          },
          "args": [],
          "env": []
        },
        {
          "name": "liqo-telemetry",
          "kind": "CronJob",
          "namespace": "liqo",
          "containerName": "telemetry",
          "image": {
            "repository": "ghcr.io/liqotech/telemetry",
            "tag": "v1.0.0"
          },
          "args": [],
          "env": []
        }
      ]
    }
  v1.0.1.json: |
    {
      "version": "v1.0.1",
      "components": [
        {
          "name": "liqo-controller-manager",
          "kind": "Deployment",
          "namespace": "liqo",
          "containerName": "controller-manager",
          "image": {
            "repository": "ghcr.io/liqotech/liqo-controller-manager",
            "tag": "v1.0.1"
          },
          "args": [
            "--cluster-id=$(CLUSTER_ID)",
            "--liqo-namespace=$(POD_NAMESPACE)",
            "--networking-enabled=true",
            "--authentication-enabled=true",
            "--offloading-enabled=true",
            "--enable-node-failure-controller=true"
          ],
          "env": [
            {
              "name": "CLUSTER_ID",
              "type": "configMapKeyRef",
              "configMapName": "liqo-cluster-id",
              "key": "CLUSTER_ID"
            },
            {
              "name": "POD_NAMESPACE",
              "type": "fieldRef",
              "value": "metadata.namespace"
            }
          ]
        },
        {
          "name": "liqo-crd-replicator",
          "kind": "Deployment",
          "namespace": "liqo",
          "containerName": "crd-replicator",
          "image": {
            "repository": "ghcr.io/liqotech/crd-replicator",
            "tag": "v1.0.1"
          },
          "args": [
            "--cluster-id=$(CLUSTER_ID)"
          ],
          "env": [
            {
              "name": "CLUSTER_ID",
              "type": "configMapKeyRef",
              "configMapName": "liqo-cluster-id",
              "key": "CLUSTER_ID"
            }
          ]
        },
        {
          "name": "liqo-webhook",
          "kind": "Deployment",
          "namespace": "liqo",
          "containerName": "webhook",
          "image": {
            "repository": "ghcr.io/liqotech/webhook",
            "tag": "v1.0.1"
          },
          "args": [
            "--webhook-port=9443",
            "--cluster-id=$(CLUSTER_ID)",
            "--liqo-namespace=$(POD_NAMESPACE)",
            "--secret-name=liqo-webhook-certs",
            "--liqo-runtime-class=liqo",
            "--podcidr=10.42.0.0/16",
            "--vk-options-default-template=liqo/virtual-kubelet-default",
            "--enable-resource-enforcement"
          ],
          "env": [
            {
              "name": "CLUSTER_ID",
              "type": "configMapKeyRef",
              "configMapName": "liqo-cluster-id",
              "key": "CLUSTER_ID"
            },
            {
              "name": "POD_NAME",
              "type": "fieldRef",
              "value": "metadata.name"
            },
            {
              "name": "POD_NAMESPACE",
              "type": "fieldRef",
              "value": "metadata.namespace"
            },
            {
              "name": "DEPLOYMENT_NAME",
              "type": "value",
              "value": "liqo-webhook"
            }
          ]
        },
        {
          "name": "liqo-ipam",
          "kind": "Deployment",
          "namespace": "liqo",
          "containerName": "ipam",
          "image": {
            "repository": "ghcr.io/liqotech/ipam",
            "tag": "v1.0.1"
          },
          "args": [
            "--pod-name=$(POD_NAME)",
            "--port=6000"
          ],
          "env": [
            {
              "name": "POD_NAME",
              "type": "fieldRef",
              "value": "metadata.name"
            },
            {
              "name": "POD_NAMESPACE",
              "type": "fieldRef",
              "value": "metadata.namespace"
            }
          ]
        },
        {
          "name": "liqo-proxy",
          "kind": "Deployment",
          "namespace": "liqo",
          "containerName": "liqo-proxy",
          "image": {
            "repository": "ghcr.io/liqotech/proxy",
            "tag": "v1.0.1"
          },
          "args": [],
          "env": []
        },
        {
          "name": "liqo-fabric",
          "kind": "DaemonSet",
          "namespace": "liqo",
          "containerName": "liqo-fabric",
          "image": {
            "repository": "ghcr.io/liqotech/fabric",
            "tag": "v1.0.1"
          },
          "args": [
            "--podname=$(POD_NAME)",
            "--nodename=$(NODE_NAME)",
            "--geneve-port=6081"
          ],
          "env": [
            {
              "name": "NODE_NAME",
              "type": "fieldRef",
              "value": "spec.nodeName"
            },
            {
              "name": "POD_NAME",
              "type": "fieldRef",
              "value": "metadata.name"
            }
          ]
        },
        {
          "name": "liqo-gateway",
          "kind": "Deployment",
          "namespace": "liqo",
          "containerName": "gateway",
          "image": {
            "repository": "ghcr.io/liqotech/gateway",
            "tag": "v1.0.1"
          },
          "args": [],
          "env": []
        },
        {
          "name": "liqo-metric-agent",
          "kind": "Deployment",
          "namespace": "liqo",
          "containerName": "metric-agent",
          "image": {
            "repository": "ghcr.io/liqotech/metric-agent",
            "tag": "v1.0.1"
          },
          "args": [
            "--cert-path=/certs/cert.pem",
            "--key-path=/certs/key.pem"
          ],
          "env": []
        },
        {
          "name": "liqo-telemetry",
          "kind": "CronJob",
          "namespace": "liqo",
          "containerName": "telemetry",
          "image": {
            "repository": "ghcr.io/liqotech/telemetry",
            "tag": "v1.0.1"
          },
          "args": [],
          "env": []
        }
      ]
    }
